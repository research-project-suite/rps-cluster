dependencies:
  - role: partitioning
    when: hard_disks is defined
  - role: mdraid_devices
    mdraid_devices_state: created
    when: mdraid_devices is defined
  - role: dmcrypt_devices
    dmcrypt_devices_state: formated
    when: dmcrypt_devices is defined
  - role: volume_groups
    volume_groups_state: present
    when: volume_groups is defined
  - role: logical_volumes
    logical_volumes_state: present
    when: logical_volumes is defined
  - role: filesystems
    filesystems_state: formated
  - role: debootstrap
    debootstrap_include:
      - linux-image-amd64
      - busybox
      - busybox-static
      - mdadm
      - lvm2
      - cryptsetup
      - openssh-server
      - btrfs-tools
      - grub-pc
      - python
      - bridge-utils
      - console-setup
      - acpi-support
  #- role: mdraid_mdadm_conf
  - role: dmcrypt_crypttab
    when: dmcrypt_devices is defined
  - role: filesystems
    filesystems_state: configured
  - role: keyboard_configuration
  - role: grub_bootloader
  - role: network_interfaces
  - role: ssh_root_access
  - role: ssh_host_key
    ssh_host_key_state: fetched
  - role: filesystems
    filesystems_state: unmounted
