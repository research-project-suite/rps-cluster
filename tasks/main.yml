---

- name: reboot
  command: shutdown --no-wall -r +1
  async: 0
  poll: 0
  ignore_errors: true

- name: wait for ssh
  local_action: wait_for host={{ ansible_host | default(inventory_hostname)  }} port=22 search_regex=OpenSSH delay={{ reboot_delay }} timeout={{ reboot_timeout }} state=started

- name: try to connect to ssh
  setup:
  retries: 10
  delay: 5
